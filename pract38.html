<!DOCTYPE html>
<html>

<head>
    <title>API de Historial Web</title>
</head>

<body>
    <h1>API de Historial Web</h1>
    <p>Presiona los botones para agregar o reemplazar un estado en el historial de navegación, retroceder o avanzar en
        el historial, o para obtener la longitud del historial y las URLs visitadas.</p>
    <p>Abre la consola del navegador para ver los mensajes de registro.</p>
    <p>Nota: La API de Historial Web no está disponible en todos los navegadores.</p>

    <br><br>
    <button id="pushState">Agregar Estado</button>
    <button id="replaceState">Reemplazar Estado</button>
    <button id="goBack">Retroceder</button>
    <button id="goForward">Avanzar</button>
    <button onclick="myFunction1()">Regresar</button>
    <button onclick="myFunction2()">Regresar 2 Paginas</button>
    <br>
    <p id="mensaje"></p>

    <br><br><br><br><br><br><br><br>

    <div id="imageGallery">
        <img src="img/20201106_111941.jpg" alt="Image 1">
        <img src="img/20201106_112004.jpg" alt="Image 2">
        <img src="img/20201106_112017.jpg" alt="Image 3">
        <img src="img/20201106_112254.jpg" alt="Image 4">
        <img src="img/20201106_112321.jpg" alt="Image 5">
    </div>

    <button id="prevImage">Imagen anterior</button>
    <button id="nextImage">Imagen siguiente</button>

    <style>
        #imageGallery img {
            width: 30%;
        }
    </style>

    <script>

        //Asignar un evento de clic al botón con id 'replaceState'
        document.getElementById('replaceState').addEventListener('click', function () {
            // Reemplazar el estado actual del historial con un nuevo estado
            history.replaceState({ page: 2 }, "título 2", "?page=2");
        });

        //Asignar un evento de clic al botón con id 'goBack' 
        document.getElementById('goBack').addEventListener('click', function () {
            // Navegar una entrada atrás en el historial
            history.back();
        });

        // Asignar un evento de clic al botón con id 'goForward'
        document.getElementById('goForward').addEventListener('click', function () {
            // Navegar una entrada adelante en el historial
            history.forward();
        });

        // Escuchar el evento 'popstate', que se dispara cuando el estado del historial cambia
        window.addEventListener("popstate", function (event) {
            // Si hay un estado asociado con la entrada actual del historial, mostrarlo
            if (event.state) {
                alert("Estado de la página: " + event.state.page);
            }
        });

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        // Comprobar si la API de Historial Web está disponible
        if (window.history && window.history.length) {
            // Obtener el historial de navegación
            var historyArray = window.history;

            // Imprimir la longitud del historial
            console.log("Longitud del historial:", historyArray.length);

            // Iterar sobre el historial e imprimir las URLs visitadas
            // Nota: Esto no funcionará en la mayoría de los navegadores por razones de seguridad
            for (var i = 0; i < historyArray.length; i++) {
                console.log("URL visitada:", historyArray[i]);
            }
        } else {
            console.log("La Web History API no está disponible en este navegador.");
        }

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        // Función que navega una entrada atrás en el historial
        function myFunction1() {
            window.history.back();
        }

        // Función que navega dos entradas atrás en el historial
        function myFunction2() {
            window.history.go(-2);
        }

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        if (window.location.href.indexOf('?page=2') > -1) {
            // Si la URL contiene '?page=2', mostrar algo en el HTML
            document.getElementById('mensaje').innerText = "Estás en la página 2.";
        }

        if (window.location.href.indexOf('?page=1') > -1) {
            // Si la URL contiene '?page=2', mostrar algo en el HTML
            document.getElementById('mensaje').innerText = "Estás en la página 1.";
        }

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        let images = document.querySelectorAll('#imageGallery img');
        let currentIndex = 0;

        // Muestra la imagen actual
        function showImage(index) {
            for (let i = 0; i < images.length; i++) {
                images[i].style.display = i === index ? 'block' : 'none';
            }
            history.pushState({ index }, `Image ${index}`, `?image=${index}`);
        }

        // Asignar un evento de clic al botón 'prevImage'
        document.getElementById('prevImage').addEventListener('click', function () {
            if (currentIndex > 0) {
                currentIndex--;
                showImage(currentIndex);
            }
        });

        // Asignar un evento de clic al botón 'nextImage'
        document.getElementById('nextImage').addEventListener('click', function () {
            if (currentIndex < images.length - 1) {
                currentIndex++;
                showImage(currentIndex);
            }
        });

        // Escuchar el evento 'popstate', que se dispara cuando el estado del historial cambia
        window.addEventListener("popstate", function (event) {
            if (event.state) {
                currentIndex = event.state.index;
                showImage(currentIndex);
            }
        });

        // Inicializar la galería mostrando la primera imagen
        showImage(0);

    </script>
</body>

</html>